<div class="fs-container">

  <div class="fs-inner-container">
    <!-- Map -->
    <div id="map-container">

      <div id="map" data-map-zoom="4" data-map-scroll="true">
          <!-- map goes here -->
      </div>

    </div>
  </div>


  <div class="fs-inner-container">
    <div class="fs-content">

      <!-- Search -->
      <section class="search margin-bottom-30">

        <%= render 'shared/search_form' %>

      </section>
      <!-- Search / End -->

      <!-- Sorting / Layout Switcher -->
      <div class="row fs-switcher">

        <div class="col-md-6">
          <!-- Showing Results -->
          <p class="showing-results"><%= @arrRooms.size %> Results Found </p>
        </div>

        <div class="col-md-6">
          <!-- Layout Switcher -->
          <div class="layout-switcher">
            <a href="#" class="list"><i class="fa fa-th-list"></i></a>
            <a href="#" class="grid"><i class="fa fa-th-large"></i></a>
          </div>
        </div>
      </div>

      <!-- Listings -->
      <div class="listings-container list-layout row fs-listings">


        <% @arrRooms.each do |room| %>

          <!-- Listing Item -->
          <div class="listing-item">

            <a href="<%= room_path(room) %>" class="listing-img-container">

              <div class="listing-img-content">
                <span class="listing-price">$900 <i>monthly</i></span>
                <span class="like-icon with-tip" data-tip-content="Add to Bookmarks"></span>
                <span class="compare-button with-tip" data-tip-content="Add to Compare"></span>
              </div>

              <%= image_tag room.cover_photo(:medium) %>

            </a>

            <div class="listing-content">

              <div class="listing-title">
                <h4><a href="<%= room_path(room) %>"><%= room.listing_name %></a></h4>
                <a href="https://maps.google.com/maps?q=221B+Baker+Street,+London,+United+Kingdom&hl=en&t=v&hnear=221B+Baker+St,+London+NW1+6XE,+United+Kingdom" class="listing-address popup-gmaps">
                  <i class="fa fa-map-marker"></i>
                  <%= room.address %>
                </a>

                <a href="<%= room_path(room) %>" class="details button border">Details</a>
              </div>

              <ul class="listing-details">
                <li><%= pluralize(room.bed_room, "Bedroom") %></li>
                <li><%= pluralize(room.bath_room, "Bathroom") %></li>
              </ul>

              <div class="listing-footer">
                <a href="#"><i class="fa fa-user"></i> <%= room.user&.fullname %></a>
                <span><i class="fa fa-calendar-o"></i> <%= (DateTime.current.to_date - room.created_at.to_date).to_i %> days ago</span>
              </div>

            </div>

          </div>
          <!-- Listing Item / End -->

        <% end %>

      </div>

    </div>
  </div>

</div>

<script>
  function initialize(rooms) {
    var location = {lat: 44.5403, lng: -78.5463}
    if (rooms.length > 0) {
      location = {lat: rooms[0].latitude, lng: rooms[0].longitude}
    }
    var map = new google.maps.Map(document.getElementById('map'), {
      center: location,
      zoom: 12
    });
    var marker, infowindow;
    rooms.forEach(function(room){
      marker = new google.maps.Marker({
        position: {lat: room.latitude, lng: room.longitude},
        map: map
      });
      infowindow = new google.maps.InfoWindow({
        content: "<div class='map_price'>$" + room.price + "</div>"
      });
      infowindow.open(map, marker);
    });
  }
  google.maps.event.addDomListener(window, 'load', function () {
    initialize(<%= raw @arrRooms.to_json %>)
  });
</script>
